{"version":3,"file":"ResilientLambdaTask.js","sourceRoot":"","sources":["../../src/construct/ResilientLambdaTask.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,mDAAqC;AACrC,wEAA0D;AAE1D;;GAEG;AACH,MAAa,mBAAoB,SAAQ,KAAK,CAAC,YAAY;IAWzD,YAAY,KAAoB,EAAE,EAAU,EAAE,KAA8B;QAC1E,KAAK,CAAC,KAAK,EAAE,EAAE,EAAE,KAAK,CAAC,CAAA;QACvB,mBAAmB,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;IAC5C,CAAC;IAED;;;OAGG;IACI,MAAM,CAAC,eAAe,CAAC,IAAwB;QACpD,uFAAuF;QACvF,IAAI,CAAC,QAAQ,CAAC;YACZ,MAAM,EAAE,mBAAmB,CAAC,eAAe;YAC3C,WAAW,EAAE,CAAC;YACd,WAAW,EAAE,CAAC;YACd,QAAQ,EAAE,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;SAClC,CAAC,CAAC;IACL,CAAC;;AA5BH,kDA6BC;AA3BwB,mCAAe,GAAa;IACjD,0BAA0B;IAC1B,6BAA6B;IAC7B,+BAA+B;IAC/B,+BAA+B;IAC/B,mEAAmE;IACnE,iCAAiC;CAClC,CAAA","sourcesContent":["import * as cdk from '@aws-cdk/core';\r\nimport * as tasks from '@aws-cdk/aws-stepfunctions-tasks';\r\n\r\n/**\r\n * Define a Lambda Invoke task with transient errors handling implemented.\r\n */\r\nexport class ResilientLambdaTask extends tasks.LambdaInvoke {\r\n\r\n  public static readonly TransientErrors: string[] = [\r\n    // Added by default in CDK\r\n    // \"Lambda.ServiceException\",\r\n    // \"Lambda.AWSLambdaException\",\r\n    // \"Lambda.SdkClientException\",\r\n    // Additional Retry condition not covered by default CDK conditions\r\n    \"Lambda.TooManyRequestsException\"\r\n  ]\r\n\r\n  constructor(scope: cdk.Construct, id: string, props: tasks.LambdaInvokeProps) {\r\n    super(scope, id, props)\r\n    ResilientLambdaTask.addDefaultRetry(this);\r\n  }\r\n\r\n  /**\r\n   * Adds retry for transient Lambda errors.\r\n   * @param task Lambda tast to modify.\r\n   */\r\n  public static addDefaultRetry(task: tasks.LambdaInvoke): void {\r\n    // https://docs.aws.amazon.com/step-functions/latest/dg/bp-lambda-serviceexception.html\r\n    task.addRetry({\r\n      errors: ResilientLambdaTask.TransientErrors,\r\n      backoffRate: 2,\r\n      maxAttempts: 6,\r\n      interval: cdk.Duration.seconds(2)\r\n    });\r\n  }\r\n}"]}