{"version":3,"file":"ResilientLambdaTask.js","sourceRoot":"","sources":["../../src/construct/ResilientLambdaTask.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,mDAAqC;AACrC,wEAA0D;AAE1D;;GAEG;AACH,MAAa,mBAAoB,SAAQ,KAAK,CAAC,YAAY;IAWzD,YAAY,KAAoB,EAAE,EAAU,EAAE,KAA8B;QAC1E,KAAK,CAAC,KAAK,EAAE,EAAE,EAAE,KAAK,CAAC,CAAA;QACvB,mBAAmB,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;IAC5C,CAAC;IAED;;;OAGG;IACI,MAAM,CAAC,eAAe,CAAC,IAAwB;QACpD,uFAAuF;QACvF,IAAI,CAAC,QAAQ,CAAC;YACZ,MAAM,EAAE,mBAAmB,CAAC,eAAe;YAC3C,WAAW,EAAE,CAAC;YACd,WAAW,EAAE,CAAC;YACd,QAAQ,EAAE,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;SAClC,CAAC,CAAC;IACL,CAAC;;AA5BH,kDA6BC;AA3BwB,mCAAe,GAAa;IACjD,0BAA0B;IAC1B,6BAA6B;IAC7B,+BAA+B;IAC/B,+BAA+B;IAC/B,mEAAmE;IACnE,iCAAiC;CAClC,CAAA","sourcesContent":["import * as cdk from '@aws-cdk/core';\nimport * as tasks from '@aws-cdk/aws-stepfunctions-tasks';\n\n/**\n * Define a Lambda Invoke task with transient errors handling implemented.\n */\nexport class ResilientLambdaTask extends tasks.LambdaInvoke {\n\n  public static readonly TransientErrors: string[] = [\n    // Added by default in CDK\n    // \"Lambda.ServiceException\",\n    // \"Lambda.AWSLambdaException\",\n    // \"Lambda.SdkClientException\",\n    // Additional Retry condition not covered by default CDK conditions\n    \"Lambda.TooManyRequestsException\"\n  ]\n\n  constructor(scope: cdk.Construct, id: string, props: tasks.LambdaInvokeProps) {\n    super(scope, id, props)\n    ResilientLambdaTask.addDefaultRetry(this);\n  }\n\n  /**\n   * Adds retry for transient Lambda errors.\n   * @param task Lambda tast to modify.\n   */\n  public static addDefaultRetry(task: tasks.LambdaInvoke): void {\n    // https://docs.aws.amazon.com/step-functions/latest/dg/bp-lambda-serviceexception.html\n    task.addRetry({\n      errors: ResilientLambdaTask.TransientErrors,\n      backoffRate: 2,\n      maxAttempts: 6,\n      interval: cdk.Duration.seconds(2)\n    });\n  }\n}"]}